# 設計記録

-----------------------------

## なぜ`mappy_align.py`で`map-ont`と`splice`の2つのプリセットで2回もアラインメントしているのか？

大きな欠失があるアレルの際に、`map-ont`だと2つのリードが分かれてアラインメントされる。  
その際に、片方のリードが（なぜか）アラインメントされないことがある。これはアラインメントのミスと考えられる。  
`splice`を用いると両方のリードがアライメントされるため、アラインメントのミスがないのでより正確なclassification, clusteringが可能であると考えられる。

### では、なぜ`map-ont`が必要なのか？

`map-ont`はレポートとしてBAMファイルを出力するさいに用いる。  
`splice`はもともとontに最適化されていないのと、inversionを正しく捉えることができない欠点があるので、ユーザーの手元に残すアラインメントは`map-ont`を利用したものとする

### 「inversionを正しく捉えることができない」とはどういうことか？

inversionの開始点がずれてしまうことが問題である。  
`tests/data/inversion/inversion_splice.sam`において、本当のinversionの開始点は1000ntだが`814nt`となりズレが生じている。  
一方で`tests/data/inversion/inversion.sam`では開始点が正しく1000ntとなっている。
そのためユーザーに報告するデータとしては、`map-ont`でアラインメントしたものを使用する。


### `splice`によってclassification, clusteringに問題はないのか

これはこれから検討する。

検証するデザインは以下の通り。
- 点変異
- 欠失
- 挿入
- 大型欠失
- 大型挿入
- 逆位
- エクソン置換

シミュレーション・リアルデータを用いる。

（2022-12-13）

-----------------------------

# Clustering

- PCAの前処理によってかなり結果が変わる。
    - とくにスケーリングするか否かが重要であり、この挙動に対する理解が必要
    - いままではvarianceを掛けていたが、これではほぼPC1の情報しか残らないので掛けないようにした
        - 細かいノイズを拾ってしまう可能性があるので、ほかのアルビノサンプルなどで検討する必要がある
- controlにおけるGaussianMixtureのn_conponentsも重要。20だと分かれすぎるきらいがあり、いまは5としている

(2023-01-20)

------------------------------
